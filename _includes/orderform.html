<div class="field">
  <label class="label">Billing email</label>
  <div class="control">
    <input class="input" type="email" id="email" />
  </div>
  <p class="help is-danger" id="email-error" style="display: none">
    Please enter valid e-mail
  </p>
</div>

<div class="field">
  <label class="label">Name for License</label>
  <div class="control">
    <input
      class="input"
      type="text"
      id="name"
      placeholder="eg. your full name or your company name"
    />
  </div>
</div>

<div class="field">
  <label class="label">Number of users</label>
  <div class="control">
    <input class="input" type="number" placeholder="1" id="users" />
  </div>
</div>

<div class="field">
  <label class="label">Subscription</label>
  <div class="control">
    <select class="input" id="subscription">
      <option value="yearly">Yearly - $238/year</option>
      <option value="monthly">Monthly - $22/month</option>
    </select>
  </div>
</div>

<p>
  <a target="_blank" class="button is-info is-medium" onclick="sendForm()"
    >Continue</a
  >
</p>

<script>
  async function sendForm() {
    var emailInput = document.getElementById("email");
    var emailError = document.getElementById("email-error");
    var email = emailInput.value;

    // Validace emailu pomocí regulárního výrazu
    var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
      // Přidání třídy 'is-danger' pro červený rámeček
      emailInput.classList.add("is-danger");
      // Zobrazení chybové zprávy
      emailError.style.display = "block";
      return;
    } else {
      // Odstranění chybového stavu
      emailInput.classList.remove("is-danger");
      emailError.style.display = "none";
    }

    // Získání dalších hodnot z formuláře
    var name = document.getElementById("name").value;
    var users = document.getElementById("users").value;
    var subscription = document.getElementById("subscription").value;

    // Příprava dat k odeslání
    var data = {
      email: email,
      name: name,
      users: users,
      subscription: subscription,
    };

    // Odeslání POST požadavku
    const response = await fetch("https://auth-proxy.dbgate.udolni.net/new-subscription", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    });
    if (response.ok) {
      alert("Subscription was successfully created.");
    } else {
      alert("An error occurred while creating the subscription.");
    }
    //   .catch(function (error) {
    //     console.error("Error:", error);
    //     alert("An error occurred while sending data.");
    //   });
  }
</script>
